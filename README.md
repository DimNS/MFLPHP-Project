# Шаблон проекта использующий микро-фреймворк [MFLPHP](https://github.com/DimNS/MFLPHP)

## Создание нового проекта
- Устанавливаем копию скелета: `composer create-project dimns/mflphp-project /my/project/path`.
- Переходим в каталог созданного проекта.
- Запускаем `composer install`.
- Запускаем `npm install`.
- Запускаем `gulp build` для сборки файлов.
- Запускаем `gulp` для автоматической пересборки при изменениях во время разработки.

## Сборка проекта
- Переходим в каталог созданного проекта.
- Запускаем `gulp build`.

## Middleware
Для проверки "пользователь в системе", "валидный токен" или "есть необходимые права доступа" достаточно выполнить хелпера-посредника:
```php
$middleware = \MFLPHP\Helpers\Middleware::start($request, $response, $service, $di, [
    'auth',         // Пользователь залогинен в системе
    'token',        // Проверка валидности защитного csrf-токена
    'access-admin', // Проверка прав доступа
]);
if ($middleware) {
    // Этот код выполняется если все проверки выполнены
}
```

## Отладка SQL-запросов
Если в настройках включен режим DEBUG, тогда включается логирование всех SQL-запросов, которые можно получить как массив:
```php
dump(\ORM::get_query_log());
```

## Примеры хелперов

### Отправка письма
```php
$send_result = $di->mail->send('АДРЕС_ДЛЯ_ОТПРАВКИ', 'ТЕМА_ПИСЬМА', 'АДРЕС_ШАБЛОНА', [
    // Данные для подстановки в шаблон
]);
if ($send_result) {
    // Письмо успешно отправлено
} else {
    // Произошла ошибка
    // Подробнее можно посмотреть в логе по адресу /errors.log
}
```
- АДРЕС_ШАБЛОНА - строка константы шаблона, размещается в файле `/app/Configs/EmailTemplates.php` в виде соответствующих констант.
- Данные для подстановки в шаблон - массив ключ-значение, где ключи это специальные строки (например: `[[SITE_NAME]]`), а значения - обычные строки для подстановки вместо ключа в шаблоне.

### Конвертор временной метки в дату для вставки в БД
```php
use MFLPHP\Helpers\FormatTime;

echo FormatTime::convert($di->cfg->time);

// Вернёт строку: 03-08-2016 09:26:21
echo FormatTime::convert(1470205581);
```